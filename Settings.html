<? 
  //FOR WHATEVER STRANGE REASON, ON ONE GMAIL ACCOUNT I'M GETTING AN ERROR
  //WHEN OPENING THE SETTINGS DIALOG, ABOUT AN UNEXPEXTED 'u' CHARACTER???
  //ONLY SEEMS TO HAPPEN WITH THE BIBLEGET ACCOUNT AND NOT OTHER ACCOUNTS
    
  var locale = getUserLocale();
  
  var scriptProperties = PropertiesService.getScriptProperties();
  if(scriptProperties.getProperty("languages")===null || scriptProperties.getProperty("versions")===null){
    //consoleLog('now setting properties from Settings.html');
    setScriptProps();
  }
  
  var propLangs = scriptProperties.getProperty("languages");
  //consoleLog(propLangs);
  languages = JSON.parse(propLangs);
  
  var propVersions = scriptProperties.getProperty("versions");
  //consoleLog(propVersions);
  var versions = JSON.parse(propVersions);
  
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('now running getUserProperties from within Settings.html');
  }   
  var userProperties = getUserProperties(true); //will be a pure JSON obj, without any stringified values (nostringify=true)
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('getUserProperties has been run from within Settings.html');
  }
  
  var lftindnt = Math.round(parseFloat(userProperties.ParagraphStyles.LeftIndent)*28.3464567); //convert to point value useful for CSS margin-left property
  var rgtindnt = Math.round(parseFloat(userProperties.ParagraphStyles.RightIndent)*28.3464567);//convert to point value useful for CSS margin-right property
  
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('left and right indent have been set based on userproperties in Settings.html');
  }   

  var wrap1 = '', wrap2 = '', wrap3 = '', wrap4 = '';
  switch(userProperties.LayoutPrefs.BibleVersionWrap){
    case BGET.WRAP.PARENTHESES:
      wrap1= '(';
      wrap2 = ')';
      break;
    case BGET.WRAP.BRACKETS:
      wrap1 = '[';
      wrap2 = ']';
      break;
    case BGET.WRAP.NONE:
      wrap1 = '';
      wrap2 = '';
      break;
  } 
  switch(userProperties.LayoutPrefs.BookChapterWrap){
    case BGET.WRAP.PARENTHESES:
      wrap3= '(';
      wrap4 = ')';
      break;
    case BGET.WRAP.BRACKETS:
      wrap3 = '[';
      wrap4 = ']';
      break;
    case BGET.WRAP.NONE:
      wrap3 = '';
      wrap4 = '';
      break;
  } 
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('wraps have been prepared for bibleversion and bookchapter based on user preferences in Settings.html');
  }   
  
  var bkChptr1Sam213 = '';
  var bkChptrPs11412 = '';
  switch(userProperties.LayoutPrefs.BookChapterFormat){
    case BGET.FORMAT.BIBLELANG:
      bkChptr1Sam213 = "I Samuelis 2";
      bkChptrPs11412 = "Psalmorum 114";
      break;
    case BGET.FORMAT.BIBLELANGABBREV:
      bkChptr1Sam213 = "ISam 2";
      bkChptrPs11412 = "Ps 114";
      break;
    case BGET.FORMAT.USERLANG: 
      bkChptr1Sam213 = __('ISamuelis2',locale);
      bkChptrPs11412 = __('Psalmorum114',locale);
      break;
    case BGET.FORMAT.USERLANGABBREV:
      bkChptr1Sam213 = __('ISam2',locale);
      bkChptrPs11412 = __('Ps114',locale);
      break;
  }
  if(JSON.parse(userProperties.LayoutPrefs.BookChapterFullQuery)){
    bkChptr1Sam213 += ((locale=='en' ? ':' : ',') + '1-3');
    bkChptrPs11412 += ((locale=='en' ? ':' : ',') + '1-2');
  }
  
  let ISam2_1 = 'Et oravit Anna et ait: Exsultavit cor meum in Domino, exaltatum est cornu meum in Deo meo; dilatatum est os meum super inimicos meos, quoniam laetata sum in salutari tuo.';
  let ISam2_2 = 'Non est sanctus ut est Dominus; neque enim est alius extra te, et non est fortis sicut Deus noster.';
  let ISam2_3 = 'Nolite multiplicare loqui sublimia gloriantes. Recedant superba de ore vestro, quia Deus scientiarum Dominus est, et ab eo ponderantur actiones.';
  let Ps114_1 = 'In exitu Israel de Aegypto, domus Iacob de populo barbaro,';
  let Ps114_2 = 'factus est Iuda sanctuarium eius, Israel potestas eius.';
  
  var nonUniqueStr = userProperties.ParagraphStyles.FONT_FAMILY;
      nonUniqueStr += bkChptr1Sam213;
      nonUniqueStr += bkChptrPs11412;
      nonUniqueStr += ISam2_1;
      nonUniqueStr += ISam2_2;
      nonUniqueStr += ISam2_3;
      nonUniqueStr += Ps114_1;
      nonUniqueStr += Ps114_2;
  //consoleLog(nonUniqueStr);
  var UniqueStr = makeUnique(nonUniqueStr);
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('UniqueStr has been set based on pagraphstyles.font_family in Settings.html');
  }   

  var PreviewBox = '<fieldset class="fieldset-results"><legend><b>' + __('Preview',locale) + '</b></legend>';
      PreviewBox += '<p class="bibleversion showtop" style="display:'+(userProperties.LayoutPrefs.ShowBibleVersion==BGET.VISIBILITY.SHOW && userProperties.LayoutPrefs.BibleVersionPosition==BGET.POS.TOP?'block':'none')+';"><span class="bcWrap">' + wrap1 + '</span>NVBSE<span class="bcWrap">' + wrap2 + '</span></p>';
      PreviewBox += '<div class="bookchapterWrapper">';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.TOP) ? '<span class="bookchapter" style="display:block;"><span class="bcWrap">' + wrap3 + '</span><span class="bcText1Sam">' + bkChptr1Sam213 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '<p class="liveview-quote" style="margin-top:-6px;padding-top:0px;">';
      PreviewBox += '<span class="versenumber" style="display:'+(userProperties.LayoutPrefs.ShowVerseNumbers==BGET.VISIBILITY.SHOW ? 'inline' : 'none')+';">1</span><span class="versetext">'+ ISam2_1 +'</span>';
      PreviewBox += '<span class="versenumber" style="display:'+(userProperties.LayoutPrefs.ShowVerseNumbers==BGET.VISIBILITY.SHOW ? 'inline' : 'none')+';">2</span><span class="versetext">'+ ISam2_2 +'</span>';
      PreviewBox += '<span class="versenumber" style="display:'+(userProperties.LayoutPrefs.ShowVerseNumbers==BGET.VISIBILITY.SHOW ? 'inline' : 'none')+';">3</span><span class="versetext">'+ ISam2_3 +'</span>';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.BOTTOMINLINE) ? '<span class="bookchapter" style="margin-left:6px;"><span class="bcWrap">' + wrap3 + '</span><span class="bcText1Sam">' + bkChptr1Sam213 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '</p>';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.BOTTOM) ? '<span class="bookchapter" style="display:block;"><span class="bcWrap">' + wrap3 + '</span><span class="bcText1Sam">' + bkChptr1Sam213 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '</div>';
      PreviewBox += '<div class="bookchapterWrapper">';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.TOP) ? '<span class="bookchapter" style="display:block;"><span class="bcWrap">' + wrap3 + '</span><span class="bcTextPs">' + bkChptrPs11412 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '<p class="liveview-quote" style="margin-top:-6px;padding-top:0px;">';
      PreviewBox += '<span class="versenumber" style="display:'+(userProperties.LayoutPrefs.ShowVerseNumbers==BGET.VISIBILITY.SHOW ? 'inline' : 'none')+';">1</span><span class="versetext">'+ Ps114_1 +'</span>';
      PreviewBox += '<span class="versenumber" style="display:'+(userProperties.LayoutPrefs.ShowVerseNumbers==BGET.VISIBILITY.SHOW ? 'inline' : 'none')+';">2</span><span class="versetext">factus est Iuda sanctuarium eius, Israel potestas eius.</span>';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.BOTTOMINLINE) ? '<span class="bookchapter" style="margin-left:6px;"><span class="bcWrap">' + wrap3 + '</span><span class="bcTextPs">' + bkChptrPs11412 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '</p>';
      PreviewBox += (userProperties.LayoutPrefs.BookChapterPosition==BGET.POS.BOTTOM) ? '<span class="bookchapter" style="display:block;"><span class="bcWrap">' + wrap3 + '</span><span class="bcTextPs">' + bkChptrPs11412 + '</span><span class="bcWrap">' + wrap4 + '</span></span>' : '';
      PreviewBox += '</div>';
      PreviewBox += '<p class="bibleversion showbottom" style="display:'+(userProperties.LayoutPrefs.ShowBibleVersion==BGET.VISIBILITY.SHOW && userProperties.LayoutPrefs.BibleVersionPosition==BGET.POS.BOTTOM?'block':'none')+';"><span class="bcWrap">' + wrap1 + '</span>NVBSE<span class="bcWrap">' + wrap2 + '</span></p>';
      PreviewBox += '</fieldset>';
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('starting HTML output in Settings.html');
  }   

?>
<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <link id="gfFontFamily" href="https://fonts.googleapis.com/css?family=<?!= userProperties.ParagraphStyles.FONT_FAMILY ?>&text=<?!= UniqueStr ?>" rel="stylesheet" />
<?!= include("Stylesheet"); ?>
<style>

.bookchapterWrapper {
  margin: 6px 0px;
}

.liveview-quote {
  line-height: <?!= userProperties.ParagraphStyles.Lineheight?>em;
  text-align: <?!=userProperties.ParagraphStyles.ParagraphAlign?>;
  margin-top: 3px;
  margin-bottom: 3px;
  margin-left: <?!= lftindnt?>pt;
  margin-right:<?!= rgtindnt?>pt;
  font-family: <?!= userProperties.ParagraphStyles.FONT_FAMILY ?>;
}

.bibleversion, .bookchapter {
  <? if(userProperties.BookChapterStyles.BOLD){ ?>font-weight: bold; <? } ?>
  font-size: <?!= userProperties.BookChapterStyles.FONT_SIZE ?>px;
  color: <?!= userProperties.BookChapterStyles.FOREGROUND_COLOR ?>;
  background-color: <?!= userProperties.BookChapterStyles.BACKGROUND_COLOR ?>;
  padding-top:0px;
  margin-bottom: 3px;
  margin-top: 0px;
  margin-left: <?!= lftindnt?>pt;
  margin-right:<?!= rgtindnt?>pt;
  font-family: <?!= userProperties.ParagraphStyles.FONT_FAMILY ?>;
  position: relative;
}
.bibleversion{
  text-align: <?!=userProperties.LayoutPrefs.BibleVersionAlignment?>;
}
.bookchapter {
  text-align: <?!=userProperties.LayoutPrefs.BookChapterAlignment?>;
  top: <?!= userProperties.BookChapterStyles.VALIGN==BGET.VALIGN.NORMAL ? 0 : (userProperties.BookChapterStyles.VALIGN==BGET.VALIGN.SUPERSCRIPT ? -4 : 4) ?>px;
}
.versenumber{
  <? if(userProperties.VerseNumberStyles.BOLD){ ?>font-weight: bold; <? } ?>
  font-size: <?!= userProperties.VerseNumberStyles.FONT_SIZE ?>px;
  color: <?!= userProperties.VerseNumberStyles.FOREGROUND_COLOR ?>;
  background-color: <?!= userProperties.VerseNumberStyles.BACKGROUND_COLOR ?>;
  position: relative;
  top: <?!= userProperties.VerseNumberStyles.VALIGN==BGET.VALIGN.NORMAL ? 0 : (userProperties.VerseNumberStyles.VALIGN==BGET.VALIGN.SUPERSCRIPT ? -4 : 4) ?>px;
}
.versetext{
  <? if(userProperties.VerseTextStyles.BOLD){ ?>font-weight: bold; <? } ?>
  font-size: <?!= userProperties.VerseTextStyles.FONT_SIZE ?>px;
  color: <?!= userProperties.VerseTextStyles.FOREGROUND_COLOR ?>;
  background-color: <?!= userProperties.VerseTextStyles.BACKGROUND_COLOR ?>;
  position: relative;
  top: <?!= userProperties.VerseTextStyles.VALIGN==BGET.VALIGN.NORMAL ? 0 : (userProperties.VerseTextStyles.VALIGN==BGET.VALIGN.SUPERSCRIPT ? -4 : 4) ?>px;
}


table, td, a {
	color: #000;
	font: normal normal 12px Verdana, Geneva, Arial, Helvetica, sans-serif;
}

/* define height and width of scrollable area. Add 16px to width for scrollbar */
div.tableContainer {
	border: 1px solid #963;
	height: <? if(Object.keys(versions).length > 3){ ?>108<? }else{ ?>85<? } ?>px;
	overflow: auto;
	width: 656px
}

/* Reset overflow value to hidden for all non-IE browsers. */
html>body div.tableContainer {
	overflow: hidden;
	width: 656px
}

/* define width of table. IE browsers only                 */
div.tableContainer table {
	float: left;
	width: 637px
}

/* define width of table. Add 16px to width for scrollbar.           */
/* All other non-IE browsers.                                        */
html>body div.tableContainer table {
	width: 656px
}

/* set table header to a fixed position. WinIE 6.x only                                       */
/* In WinIE 6.x, any element with a position property set to relative and is a child of       */
/* an element that has an overflow property set, the relative value translates into fixed.    */
/* Ex: parent element DIV with a class of tableContainer has an overflow property set to auto */
thead.fixedHeader tr {
	position: relative
}

/* set THEAD element to have block level attributes. All other non-IE browsers            */
/* this enables overflow to work on TBODY element. All other non-IE, non-Mozilla browsers */
html>body thead.fixedHeader tr {
	display: block
}

/* make the TH elements pretty */
thead.fixedHeader th {
	background: #C96;
	border-left: 1px solid #EB8;
	border-right: 1px solid #B74;
	border-top: 1px solid #EB8;
	font-weight: normal;
	padding: 4px 3px;
	text-align: left
}

/* make the A elements pretty. makes for nice clickable headers                */
thead.fixedHeader a, thead.fixedHeader a:link, thead.fixedHeader a:visited {
	color: #FFF;
	display: block;
	text-decoration: none;
	width: 100%
}

/* make the A elements pretty. makes for nice clickable headers                */
/* WARNING: swapping the background on hover may cause problems in WinIE 6.x   */
thead.fixedHeader a:hover {
	color: #FFF;
	display: block;
	text-decoration: underline;
	width: 100%
}

/* define the table content to be scrollable                                              */
/* set TBODY element to have block level attributes. All other non-IE browsers            */
/* this enables overflow to work on TBODY element. All other non-IE, non-Mozilla browsers */
/* induced side effect is that child TDs no longer accept width: auto                     */
tbody.scrollContent {
	display: block;
	height: <? if(Object.size(versions) > 3){ ?>85<? }else{ ?>62<? } ?>px;
	overflow: auto;
	width: 100%
}

/* make TD elements pretty. Provide alternating classes for striping the table */
/* http://www.alistapart.com/articles/zebratables/                             */
tbody.scrollContent td, tbody.scrollContent tr.normalRow td {
	background: #FFF;
	border-bottom: none;
	border-left: none;
	border-right: 1px solid #CCC;
	border-top: 1px solid #DDD;
	padding: 2px 3px 3px 4px
}

tbody.scrollContent tr.alternateRow td {
	background: #EEE;
	border-bottom: none;
	border-left: none;
	border-right: 1px solid #CCC;
	border-top: 1px solid #DDD;
	padding: 2px 3px 3px 4px
}

/* define width of TH elements: 1st, 2nd, and 3rd respectively.          */
/* Add 16px to last TH for scrollbar padding. All other non-IE browsers. */
/* http://www.w3.org/TR/REC-CSS2/selector.html#adjacent-selectors        */
html>body thead.fixedHeader th {
	width: 150px
}

html>body thead.fixedHeader th + th {
	width: 400px
}

html>body thead.fixedHeader th + th + th {
	width: 106px
}

/* define width of TD elements: 1st, 2nd, and 3rd respectively.          */
/* All other non-IE browsers.                                            */
/* http://www.w3.org/TR/REC-CSS2/selector.html#adjacent-selectors        */
html>body tbody.scrollContent td {
	width: 151px
}

html>body tbody.scrollContent td + td {
	width: 400px
}

html>body tbody.scrollContent td + td + td {
	width: 105px
}

.custom-combobox {
  position: relative;
  display: inline-block;
  right: 2px;
  top: 0.5px;
}
.custom-combobox-toggle {
  position: absolute;
  top: 0;
  bottom: 0;
  margin-left: -1px;
  padding: 0;
}
.custom-combobox-input {
  margin: 0;
  padding: 7.5px 10px;
  background: -webkit-linear-gradient(top, #f5f5f5, #f1f1f1);
  background-position: 95% 50%;
  background-repeat: no-repeat;
  border: 2px inset #ccc;
}

.flexcontainer {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}

.flexcontainer .flexitem.bibleget-font-family {
  min-width: 215px;
}

.bget-fontfamily-combobox {
  max-width: 245px;
}

.flexcontainerX {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}

.flexcontainerV {
  display: flex;
  flex-direction: column;
  border-right: 1px groove White;
}
.flexcontainerV:last-child {
  border-right: none;
}

.flexcontainerB {
  display: flex;
  flex-direction: row;
  justify-content: center;
}

.flexitemB {
  text-align: center;
  font-size: .7em;
  padding: 0 3px;
}

.ctrlGrpLbl {
  font-weight: bold;
}

.centered {
  text-align: center;
  font-weight: bold;
  height: 3em;
}

.flexitemB .ui-controlgroup-vertical .ui-controlgroup-item {
  text-align: center;
}

#tab2 fieldset {
  min-height: 200px;
}

/* override some jquery ui stylings to fix things up to the pixel (or fraction of a pixel!) */

ul.ui-autocomplete.ui-widget {
  max-height: 300px;
  overflow-y: scroll;
  overflow-x: hidden;
}

span.ui-checkboxradio-icon { display: none; }

.ui-button {
  line-height: 1.3em;
  min-height: 1.3em;
}

.ui-button.ui-widget.ui-checkboxradio-radio-label.ui-checkboxradio-checked.ui-state-active.ui-checkboxradio-label.ui-controlgroup-item { position:relative; top: .3px; }

.ui-selectmenu-menu.ui-front.ui-selectmenu-open li.ui-menu-item div.ui-menu-item-wrapper.ui-state-active {
  background-image: none;
  background-color: #1a73e8;
  color: White;
}

.ui-widget {
  font-size: 1em;
}

#rightIndentIncreaseBtn .material-icons,#rightIndentDecreaseBtn .material-icons {
  transform: scale(-1, 1);
}
<?
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('styles in head of document have been set in Settings.html');
  }   
?>
</style>
</head>
<body>
<div class="spinner lds-ring" id="spinner-gif"><div></div><div></div><div></div><div></div></div>
<div class="spinner" id="spinner-bg"></div>
<input type="hidden" id="activetab" value="<?!=activetab?>" />
<div id="tabs">
  <ul>
    <li><a href="#tab1"><?=__('Text Formatting',locale)?></a></li>
    <li><a href="#tab2"><?=__('Preferred Layout',locale)?></a></li>
    <li><a href="#tab3"><?=__('Versions and Languages',locale)?></a></li>
  </ul>
  <!-- BEGIN TAB 1-->
  <div id="tab1">
    <div id="accordion">    
      <h3><b><?=__('Paragraph Styles',locale)?></b></h3>
      <div class="toolbar ui-widget-header ui-corner-bottom flexcontainer">
        <div class="flexitem">
          <span class="buttonset" title="<?!=__('Left Indent',locale)?>">
          <button id="leftIndentDecreaseBtn" class="ui-button indentbtn" title="<?!=__('Left Indent decrease',locale)?>"><i class="material-icons md-18">format_indent_decrease</i></button>
          <button id="leftIndentIncreaseBtn" class="ui-button indentbtn" title="<?!=__('Left Indent increase',locale)?>"><i class="material-icons md-18">format_indent_increase</i></button>
          </span>
        </div>
        <div class="flexitem">
          <span id="paragraphalign" class="buttonset">
            <input type="radio" id="paragraphalign-left" value="<?!=BGET.ALIGN.LEFT?>" name="paragraphalign" <? if (userProperties.ParagraphStyles.ParagraphAlign==BGET.ALIGN.LEFT) { ?>CHECKED<? } ?>><label for="paragraphalign-left"><i class="material-icons md-18">format_align_left</i></label>
            <input type="radio" id="paragraphalign-center" value="<?!=BGET.ALIGN.CENTER?>" name="paragraphalign"<? if (userProperties.ParagraphStyles.ParagraphAlign==BGET.ALIGN.CENTER) { ?>CHECKED<? } ?>><label for="paragraphalign-center"><i class="material-icons md-18">format_align_center</i></label>
            <input type="radio" id="paragraphalign-right" value="<?!=BGET.ALIGN.RIGHT?>" name="paragraphalign"<? if (userProperties.ParagraphStyles.ParagraphAlign==BGET.ALIGN.RIGHT) { ?>CHECKED<? } ?>><label for="paragraphalign-right"><i class="material-icons md-18">format_align_right</i></label>
            <input type="radio" id="paragraphalign-justify" value="<?!=BGET.ALIGN.JUSTIFY?>" name="paragraphalign"<? if (userProperties.ParagraphStyles.ParagraphAlign==BGET.ALIGN.JUSTIFY) { ?>CHECKED<? } ?>><label for="paragraphalign-justify"><i class="material-icons md-18">format_align_justify</i></label>
          </span>          
        </div>
        <div class="flexitem bibleget-font-family">
          <select id="bibleget-font-family" class="bget-fontfamily-combobox"></select>
        </div>
        <div class="flexitem">
          <span id="lineheightBtn" class="ui-button"><i class="material-icons md-18">format_line_spacing</i></span>
          <select id="Lineheight-quote" class="selectmenu">
            <option value="1.0"<? if(userProperties.ParagraphStyles.Lineheight=="1.0"){ ?> SELECTED<? } ?>>Single 1.0</option>
            <option value="1.15"<? if(userProperties.ParagraphStyles.Lineheight=="1.15"){ ?> SELECTED<? } ?>>1.15</option>
            <option value="1.5"<? if(userProperties.ParagraphStyles.Lineheight=="1.5"){ ?> SELECTED<? } ?>>1&#189;</option>
            <option value="2.0"<? if(userProperties.ParagraphStyles.Lineheight=="2.0"){ ?> SELECTED<? } ?>>Double 2.0</option>
          </select>
        </div>
        <div class="flexitem">
          <span class="buttonset" title="<?!=__('Right Indent',locale)?>">
          <button id="rightIndentIncreaseBtn" class="ui-button indentbtn" title="<?!=__('Right Indent increase',locale)?>"><i class="material-icons md-18">format_indent_increase</i></button>
          <button id="rightIndentDecreaseBtn" class="ui-button indentbtn" title="<?!=__('Right Indent decrease',locale)?>"><i class="material-icons md-18">format_indent_decrease</i></button>
          </span>
        </div>
      </div>
            
      <h3><b><?!=__('Book / Chapter Format',locale)?></b></h3>
      <div class="toolbar ui-widget-header ui-corner-bottom">
        <div>
          <span id="bookchapterstyle" class="buttonset">
            <input type="checkbox" id="bookchapter-bold" value="bold" name="bookchapterstyle" <? if (userProperties.BookChapterStyles.BOLD) { ?>CHECKED<? } ?>><label for="bookchapter-bold"><b><span title="GRASSETTO">G</span></b></label>
            <input type="checkbox" id="bookchapter-italic" value="italic" name="bookchapterstyle" <? if (userProperties.BookChapterStyles.ITALIC) { ?>CHECKED<? } ?>><label for="bookchapter-italic"><b><i><span title="CORSIVO">C</span></i></b></label>
            <input type="checkbox" id="bookchapter-underline" value="underline" name="bookchapterstyle" <? if (userProperties.BookChapterStyles.UNDERLINE) { ?>CHECKED<? } ?>><label for="bookchapter-underline"><b><u><span title="SOTTOLINEATO">S</span></u></b></label>
          </span>      
          <span id="bookchapteralignment" class="buttonset">
            <input type="radio" id="bookchapter-normal" value="<?!=BGET.VALIGN.NORMAL?>" name="bookchapteralignment" <? if (userProperties.BookChapterStyles.VALIGN==BGET.VALIGN.NORMAL) { ?>CHECKED<? } ?>><label for="bookchapter-normal"><span title="NORMAL"><b>A</b></span></label>
            <input type="radio" id="bookchapter-superscript" value="<?!=BGET.VALIGN.SUPERSCRIPT?>" name="bookchapteralignment"<? if (userProperties.BookChapterStyles.VALIGN==BGET.VALIGN.SUPERSCRIPT) { ?>CHECKED<? } ?>><label for="bookchapter-superscript"><span title="SUPERSCRIPT"><b style="position: relative; top: -0.5em; font-size: 80%;">A</b></span></label>
            <input type="radio" id="bookchapter-subscript" value="<?!=BGET.VALIGN.SUBSCRIPT?>" name="bookchapteralignment"<? if (userProperties.BookChapterStyles.VALIGN==BGET.VALIGN.SUBSCRIPT) { ?>CHECKED<? } ?>><label for="bookchapter-subscript"><span title="SUBSCRIPT"><b style="position: relative; top: 0.5em; font-size: 80%;">A</b></span></label>
          </span>
          <select id="bookchapter-fontsize" name="bookchapter-fontsize" class="fontsizes gapp-addon">
          <? var ops=[8,9,10,11,12,14,18,24,30,36,48,60,72,96]; 
             for(var i=0;i<ops.length;i++){ ?>
             <option value=<?!= ops[i] ?><? if(userProperties.BookChapterStyles.FONT_SIZE == ops[i]){ ?> SELECTED<? } ?>><?= ops[i] ?></option>
          <? } ?>
          </select>
          <input type="color" id="bookchapter-color" value="<?!= userProperties.BookChapterStyles.FOREGROUND_COLOR ?>" />
          <input type="color" id="bookchapter-bgcolor" value="<?!= userProperties.BookChapterStyles.BACKGROUND_COLOR ?>" />
        </div>
      </div>    

      <h3><b><?!=__('Verse Number Format',locale)?></b></h3>
      <div class="toolbar ui-widget-header ui-corner-bottom">
        <div>
          <span id="versenumberstyle" class="buttonset">
            <input type="checkbox" id="versenumber-bold" name="versenumberstyle" <? if(userProperties.VerseNumberStyles.BOLD){ ?>CHECKED<? } ?>><label for="versenumber-bold"><b><span>G</span></b></label>
            <input type="checkbox" id="versenumber-italic" name="versenumberstyle" <? if(userProperties.VerseNumberStyles.ITALIC){ ?>CHECKED<? } ?>><label for="versenumber-italic"><i><span>C</span></i></label>
            <input type="checkbox" id="versenumber-underline" name="versenumberstyle" <? if(userProperties.VerseNumberStyles.UNDERLINE){ ?>CHECKED<? } ?>><label for="versenumber-underline"><u><span>S</span></u></label>
          </span>
          <span id="versenumberalignment" class="buttonset">
            <input type="radio" id="versenumber-normal" value="<?!=BGET.VALIGN.NORMAL?>" name="versenumberalignment" <? if(userProperties.VerseNumberStyles.VALIGN==BGET.VALIGN.NORMAL){ ?>CHECKED<? } ?>><label for="versenumber-normal"><span title="NORMAL"><b>A</b></span></label>
            <input type="radio" id="versenumber-superscript" value="<?!=BGET.VALIGN.SUPERSCRIPT?>" name="versenumberalignment"  <? if(userProperties.VerseNumberStyles.VALIGN==BGET.VALIGN.SUPERSCRIPT){ ?>CHECKED<? } ?>><label for="versenumber-superscript"><span title="SUPERSCRIPT"><b style="position: relative; top: -0.5em; font-size: 80%;">A</b></span></label>
            <input type="radio" id="versenumber-subscript" value="<?!=BGET.VALIGN.SUBSCRIPT?>" name="versenumberalignment" <? if(userProperties.VerseNumberStyles.VALIGN==BGET.VALIGN.SUBSCRIPT){ ?>CHECKED<? } ?>><label for="versenumber-subscript"><span title="SUBSCRIPT"><b style="position: relative; top: 0.5em; font-size: 80%;">A</b></span></label>
          </span>
          <select id="versenumber-fontsize" name="versenumber-fontsize" class="fontsizes gapp-addon">
          <? var ops=[8,9,10,11,12,14,18,24,30,36,48,60,72,96]; 
             for(var i=0;i<ops.length;i++){ ?>
             <option value=<?= ops[i] ?><? if(userProperties.VerseNumberStyles.FONT_SIZE == ops[i]){ ?> SELECTED<? } ?>><?= ops[i] ?></option>
          <? } ?>
          </select>
          <input type="color" id="versenumber-color" value="<?!= userProperties.VerseNumberStyles.FOREGROUND_COLOR ?>" />
          <input type="color" id="versenumber-bgcolor" value="<?!= userProperties.VerseNumberStyles.BACKGROUND_COLOR ?>" />
        </div>
      </div>    

      <h3><b><?!=__('Verse Text Format',locale)?></b></h3>
      <div class="toolbar ui-widget-header ui-corner-bottom">
        <div>
          <span id="versetextstyle" class="buttonset">
            <input type="checkbox" id="versetext-bold" name="versetext-bold" <? if(userProperties.VerseTextStyles.BOLD){ ?>CHECKED<? } ?>><label for="versetext-bold"><b><span>G</span></b></label>
            <input type="checkbox" id="versetext-italic" name="versetext-italic" <? if(userProperties.VerseTextStyles.ITALIC){ ?>CHECKED<? } ?>><label for="versetext-italic"><b><i><span>C</span></i></b></label>
            <input type="checkbox" id="versetext-underline" name="versetext-underline" <? if(userProperties.VerseTextStyles.UNDERLINE){ ?>CHECKED<? } ?>><label for="versetext-underline"><b><u><span>S</span></u></b></label>
          </span>      
          <span id="versetextalignment" class="buttonset">
            <input type="radio" id="versetext-normal" name="versetextalignment" value="<?!=BGET.VALIGN.NORMAL?>" <? if(userProperties.VerseTextStyles.VALIGN == BGET.VALIGN.NORMAL){ ?>CHECKED<? } ?>><label for="versetext-normal"><span title="NORMAL"><b>A</b></span></label>
            <input type="radio" id="versetext-superscript" name="versetextalignment" value="<?!=BGET.VALIGN.SUPERSCRIPT?>" <? if(userProperties.VerseTextStyles.VALIGN == BGET.VALIGN.SUPERSCRIPT){ ?>CHECKED<? } ?>><label for="versetext-superscript"><span title="SUPERSCRIPT"><b style="position: relative; top: -0.5em; font-size: 80%;">A</b></span></label>
            <input type="radio" id="versetext-subscript" name="versetextalignment" value="<?!=BGET.VALIGN.SUBSCRIPT?>" <? if(userProperties.VerseTextStyles.VALIGN == BGET.VALIGN.SUBSCRIPT){ ?>CHECKED<? } ?>><label for="versetext-subscript"><span title="SUBSCRIPT"><b style="position: relative; top: 0.5em; font-size: 80%;">A</b></span></label>
          </span>
          <select id="versetext-fontsize" name="versetext-fontsize" class="fontsizes gapp-addon">
            <? var ops=[8,9,10,11,12,14,18,24,30,36,48,60,72,96]; 
            for(var i=0;i<ops.length;i++){ ?>
            <option value=<?!= ops[i] ?><? if(userProperties.VerseTextStyles.FONT_SIZE == ops[i]){ ?> SELECTED<? } ?>><?= ops[i] ?></option>
            <? } ?>
          </select>
          <input type="color" id="versetext-color" value="<?!= userProperties.VerseTextStyles.FOREGROUND_COLOR ?>" />
          <input type="color" id="versetext-bgcolor" value="<?!= userProperties.VerseTextStyles.BACKGROUND_COLOR ?>" />
        </div>
      </div> <!-- END TOOLBAR WIDGET -->    
    </div> <!-- END ACCORDION  -->
    <?!= PreviewBox ?>
    <div>
      <p><?!=__("Some Bible versions have their own formatting. This is left by default to keep the text as close as possible to the original. If however you need to have consistent formatting in your document, you may override the Bible version's own formatting.",locale)?></p>
      <input type="checkbox" id="no-version-formatting" name="no-version-formatting" <? if(JSON.parse(userProperties.ParagraphStyles.NoVersionFormatting)){ ?>CHECKED<? } ?>><label for="noversionformatting"><?!=__("Override Bible version formatting",locale)?></label>
    </div>
  </div>  
  <!-- END TAB 1-->
  <!-- BEGIN TAB 2-->
  <div id="tab2">
<!--
        ShowBibleVersion: BGET.VISIBILITY.SHOW,
        BibleVersionAlignment: BGET.ALIGN.LEFT,
        BibleVersionPosition: BGET.POS.TOP,
        BibleVersionWrap: BGET.WRAP.NONE,
        BookChapterPosition: BGET.POS.INLINE,
        BookChapterAlignment: BGET.ALIGN.LEFT,
        BookChapterWrap: BGET.WRAP.NONE
        ShowVerseNumbers: BGET.VISIBILITY.SHOW,
-->
    <div class="flexcontainerX">
    
    <div class="flexcontainerV">
      <div class="centered"><?!=__('Bible version',locale)?></div>
      <div class="flexcontainerB">
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Visibility',locale)?></span><br />
          <span id="ShowBibleVersion" class="buttonset">
            <label><input type="radio" name="ShowBibleVersion" value="<?!=BGET.VISIBILITY.SHOW?>" <? if(userProperties.LayoutPrefs.ShowBibleVersion == BGET.VISIBILITY.SHOW){ ?>CHECKED<? } ?> /><?!=__('Show',locale)?></label>
            <label><input type="radio" name="ShowBibleVersion" value="<?!=BGET.VISIBILITY.HIDE?>" <? if(userProperties.LayoutPrefs.ShowBibleVersion == BGET.VISIBILITY.HIDE){ ?>CHECKED<? } ?> /><?!=__('Hide',locale)?></label>
          </span>
        </div>
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Wrap',locale)?></span><br />
          <span id="BibleVersionWrap" class="buttonset">
            <label><input type="radio" name="BibleVersionWrap" value="<?!=BGET.WRAP.NONE?>" <? if(userProperties.LayoutPrefs.BibleVersionWrap == BGET.WRAP.NONE){ ?>CHECKED<? } ?> /><?!=__('None',locale)?></label>
            <label><input type="radio" name="BibleVersionWrap" value="<?!=BGET.WRAP.PARENTHESES?>" <? if(userProperties.LayoutPrefs.BibleVersionWrap == BGET.WRAP.PARENTHESES){ ?>CHECKED<? } ?> /><?!=__('Parentheses',locale)?></label>
            <label><input type="radio" name="BibleVersionWrap" value="<?!=BGET.WRAP.BRACKETS?>" <? if(userProperties.LayoutPrefs.BibleVersionWrap == BGET.WRAP.BRACKETS){ ?>CHECKED<? } ?> /><?!=__('Brackets',locale)?></label>
          </span>
        </div>
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Alignment',locale)?></span><br />
          <span id="BibleVersionAlignment" class="buttonset">
            <label><input type="radio" name="BibleVersionAlignment" value="<?!=BGET.ALIGN.LEFT?>" <? if(userProperties.LayoutPrefs.BibleVersionAlignment == BGET.ALIGN.LEFT){ ?>CHECKED<? } ?> /><?!=__('Left',locale)?></label>
            <label><input type="radio" name="BibleVersionAlignment" value="<?!=BGET.ALIGN.CENTER?>" <? if(userProperties.LayoutPrefs.BibleVersionAlignment == BGET.ALIGN.CENTER){ ?>CHECKED<? } ?> /><?!=__('Center',locale)?></label>
            <label><input type="radio" name="BibleVersionAlignment" value="<?!=BGET.ALIGN.RIGHT?>" <? if(userProperties.LayoutPrefs.BibleVersionAlignment == BGET.ALIGN.RIGHT){ ?>CHECKED<? } ?> /><?!=__('Right',locale)?></label>
          </span>
        </div>

        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Positioning',locale)?></span><br />
          <span id="BibleVersionPosition" class="buttonset">
            <label><input type="radio" name="BibleVersionPosition" value="<?!=BGET.POS.TOP?>" <? if(userProperties.LayoutPrefs.BibleVersionPosition == BGET.POS.TOP){ ?>CHECKED<? } ?> /><?!=__('Top',locale)?></label>
            <label><input type="radio" name="BibleVersionPosition" value="<?!=BGET.POS.BOTTOM?>" <? if(userProperties.LayoutPrefs.BibleVersionPosition == BGET.POS.BOTTOM){ ?>CHECKED<? } ?> /><?!=__('Bottom',locale)?></label>
          </span>
        </div>
    
      </div><!-- flexcontainerB END -->
      
    </div><!-- flexcontainerV END-->
    
    <div class="flexcontainerV">
      <div class="centered"><?!=__('Book and Chapter',locale)?></div>
      <div class="flexcontainerB">    
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Format',locale)?></span><br />
          <span id="BookChapterFormat" class="buttonset">
            <label><input type="radio" name="BookChapterFormat" value="<?!=BGET.FORMAT.BIBLELANG?>" <? if(userProperties.LayoutPrefs.BookChapterFormat == BGET.FORMAT.BIBLELANG){ ?>CHECKED<? } ?> /><?!=__('Language of Bible version',locale)?></label>
            <label><input type="radio" name="BookChapterFormat" value="<?!=BGET.FORMAT.BIBLELANGABBREV?>" <? if(userProperties.LayoutPrefs.BookChapterFormat == BGET.FORMAT.BIBLELANGABBREV){ ?>CHECKED<? } ?> /><?!=__('Language of Bible version (abbrev)',locale)?></label>
            <label><input type="radio" name="BookChapterFormat" value="<?!=BGET.FORMAT.USERLANG?>" <? if(userProperties.LayoutPrefs.BookChapterFormat == BGET.FORMAT.USERLANG){ ?>CHECKED<? } ?> /><?!=__('Language of Docs interface',locale)?></label>
            <label><input type="radio" name="BookChapterFormat" value="<?!=BGET.FORMAT.USERLANGABBREV?>" <? if(userProperties.LayoutPrefs.BookChapterFormat == BGET.FORMAT.USERLANGABBREV){ ?>CHECKED<? } ?> /><?!=__('Language of Docs interface (abbrev)',locale)?></label>
          </span>
          <label><input type="checkbox" id="BookChapterFullQuery" name="BookChapterFullQuery" <? if(JSON.parse(userProperties.LayoutPrefs.BookChapterFullQuery) == true){ ?>CHECKED<? } ?> /><?!=__('Show full reference',locale)?></label>
        </div>    
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Wrap',locale)?></span><br />
          <span id="BookChapterWrap" class="buttonset">
            <label><input type="radio" name="BookChapterWrap" value="<?!=BGET.WRAP.NONE?>" <? if(userProperties.LayoutPrefs.BookChapterWrap == BGET.WRAP.NONE){ ?>CHECKED<? } ?> /><?!=__('None',locale)?></label>
            <label><input type="radio" name="BookChapterWrap" value="<?!=BGET.WRAP.PARENTHESES?>" <? if(userProperties.LayoutPrefs.BookChapterWrap == BGET.WRAP.PARENTHESES){ ?>CHECKED<? } ?> /><?!=__('Parentheses',locale)?></label>
            <label><input type="radio" name="BookChapterWrap" value="<?!=BGET.WRAP.BRACKETS?>" <? if(userProperties.LayoutPrefs.BookChapterWrap == BGET.WRAP.BRACKETS){ ?>CHECKED<? } ?> /><?!=__('Brackets',locale)?></label>
          </span>
        </div>
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Alignment',locale)?></span><br />
          <span id="BookChapterAlignment" class="buttonset">
            <label><input type="radio" name="BookChapterAlignment" value="<?!=BGET.ALIGN.LEFT?>" <? if(userProperties.LayoutPrefs.BookChapterAlignment == BGET.ALIGN.LEFT){ ?>CHECKED<? } ?> /><?!=__('Left',locale)?></label>
            <label><input type="radio" name="BookChapterAlignment" value="<?!=BGET.ALIGN.CENTER?>" <? if(userProperties.LayoutPrefs.BookChapterAlignment == BGET.ALIGN.CENTER){ ?>CHECKED<? } ?> /><?!=__('Center',locale)?></label>
            <label><input type="radio" name="BookChapterAlignment" value="<?!=BGET.ALIGN.RIGHT?>" <? if(userProperties.LayoutPrefs.BookChapterAlignment == BGET.ALIGN.RIGHT){ ?>CHECKED<? } ?> /><?!=__('Right',locale)?></label>
          </span>
        </div>
      
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Positioning',locale)?></span><br />
          <span id="BookChapterPosition" class="buttonset">
            <label><input type="radio" name="BookChapterPosition" value="<?!=BGET.POS.TOP?>" <? if(userProperties.LayoutPrefs.BookChapterPosition == BGET.POS.TOP){ ?>CHECKED<? } ?> /><?!=__('Top',locale)?></label>
            <label><input type="radio" name="BookChapterPosition" value="<?!=BGET.POS.BOTTOM?>" <? if(userProperties.LayoutPrefs.BookChapterPosition == BGET.POS.BOTTOM){ ?>CHECKED<? } ?> /><?!=__('Bottom',locale)?></label>
            <label><input type="radio" name="BookChapterPosition" value="<?!=BGET.POS.BOTTOMINLINE?>" <? if(userProperties.LayoutPrefs.BookChapterPosition == BGET.POS.BOTTOMINLINE){ ?>CHECKED<? } ?> /><?!=__('Bottom Inline',locale)?></label>
          </span>
        </div>
    
      </div><!-- flexcontainerB END -->
    </div><!-- flexcontainerV END -->
        
    <div class="flexcontainerV">
      <div class="centered"><?!=__('Verse number',locale)?></div>
      <div class="flexcontainerB">
    
        <div class="flexitemB">
          <span class="ctrlGrpLbl"><?!=__('Visibility',locale)?></span><br />
          <span id="ShowVerseNumbers" class="buttonset">
            <label><input type="radio" name="ShowVerseNumbers" value="<?!=BGET.VISIBILITY.SHOW?>" <? if(userProperties.LayoutPrefs.ShowVerseNumbers == BGET.VISIBILITY.SHOW){ ?>CHECKED<? } ?> /><?!=__('Show',locale)?></label>
            <label><input type="radio" name="ShowVerseNumbers" value="<?!=BGET.VISIBILITY.HIDE?>" <? if(userProperties.LayoutPrefs.ShowVerseNumbers == BGET.VISIBILITY.HIDE){ ?>CHECKED<? } ?> /><?!=__('Hide',locale)?></label>
          </span>
        </div>
    
      </div><!-- flexcontainerB END -->
    </div><!-- flexcontainerV END -->
    
    </div><!-- flexContainerX END -->
    <?!= PreviewBox ?>
    <? if(CURRENTSTATE==ADDONSTATE.DEVELOPMENT){ ?>
    <fieldset style="font-size:.5em;">
      <legend>Debug: userProps and updateUserProps</legend>
      <div style="display:flex;flex-direction: row;justify-content: space-between;">
      <div>
        <p><b>userPropsFromServer</b></p>
        <ol id="userPropsFromServer">
        </ol>
      </div>
      <div>
        <p><b>userPropsAfterUpdate</b></p>
        <ol id="userPropsAfterUpdate">
        </ol>
      </div>
      <div>
        <p><b>userPropsClientJSAfterUpdate</b></p>
        <ol id="userPropsClientJSAfterUpdate">
        </ol>
      </div>
      </div>
    </fieldset>
    <? } ?>
  </div>
  <!-- END TAB 2-->
  
  <div id="tab3">
    <p style="text-align:justify;"><?=__('p7A',locale)?> <span style="color:Blue;"><?=languages.length?></span> <?=__('p7B',locale)?> <br />
      <? for(var i in languages){ 
      if(i==0){?><i style="color:Blue;"><?=_l(languages[i],locale)?></i><?}
      else{?>, <i style="color:Blue;"><?=_l(languages[i],locale)?></i><?}
      }?>
    </p>
    <p><span style="color:Blue;"><?=Object.keys(versions).length?></span> <?=__('p8')?></p>
    <div id="tableContainer" class="tableContainer">
      <table border="0" cellpadding="0" cellspacing="0" width="100%" class="scrollTable">
        <thead class="fixedHeader">
          <tr class="alternateRow"><th><a href="#"><?=toProperCase(__('ABBREVIATION',locale))?></a></th><th><a href="#"><?=__('Full Name',locale)?></a></th><th><a href="#"><?=__('Year',locale)?></a></th></tr>
        </thead>
        <tbody class="scrollContent">
        <?var info = []; var x=0; for(var i in versions){ info = versions[i].split("|"); ?>
          <tr class="<?=x%2==0?"normalRow":"alternateRow"?>"><td><?=i?></td><td><?=info[0]?></td><td><?=info[1]?></td></tr>
        <?x++;}?>
        </tbody>
      </table>
    </div>        
    <div style="clear:both;text-align:center;margin-top:16px;"><button class="button" id="updatedata"><?=__('UPDATE DATA FROM BIBLEGET SERVER',locale)?></button></div>
    <hr style="margin-top:16px;" />
    <div style="text-align:center;margin-top:16px;"><button class="button" id="RESET_DEFAULT_USERPROPS"><?=__('RESET PREFERENCES TO DEFAULT OPTIONS',locale)?></button></div>
  </div>
  <!-- END TAB 3-->

</div>
<!-- -->
<?
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('body html complete, now preparing scripts in footer of document in Settings.html');
  }   
?>

<?!= include("FontListAutocomplete"); ?>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<?!= include("FontListCombobox"); ?>

<script type="text/javascript">

//this will be our global variable that holds the user preferences, which should be a pure JSON obj without stringified values (nostringify=true)
window.userProps = {};
userProps.populated = false;
window.domopscomplete = false;
window.leftindent = <?!=Math.round(parseFloat(userProperties.ParagraphStyles.LeftIndent)*28.3464567)?>; //convert to point size useful for CSS margin-left property
window.rightindent = <?!=Math.round(parseFloat(userProperties.ParagraphStyles.LeftIndent)*28.3464567)?>; //convert to point size useful for CSS margin-right property
var bkChptr1Sam213 = '';
var bkChptrPs11412 = '';
switch('<?!=userProperties.LayoutPrefs.BookChapterFormat?>'){
  case '<?!=BGET.FORMAT.BIBLELANG?>':
    bkChptr1Sam213 = "I Samuelis 2";
    bkChptrPs11412 = "Psalmorum 114";
    break;
  case '<?!=BGET.FORMAT.BIBLELANGABBREV?>':
    bkChptr1Sam213 = "ISam 2";
    bkChptrPs11412 = "Ps 114";
    break;
  case '<?!=BGET.FORMAT.USERLANG?>': 
    bkChptr1Sam213 = '<?!=__('ISamuelis2',locale)?>';
    bkChptrPs11412 = '<?!=__('Psalmorum114',locale)?>';
    break;
  case '<?!=BGET.FORMAT.USERLANGABBREV?>':
    bkChptr1Sam213 = '<?!=__('ISam2',locale)?>';
    bkChptrPs11412 = '<?!=__('Ps114',locale)?>';
    break;
}

//We can't save the userProps obj unless we have all the user Properties in this object, this is why we need the object,
//and need it fully populated, not only available to populate one at a time
var passUserPropertiesServer2Client = function(propsobj){ 
    userProps.populated = true;
    userProps = propsobj;
    <? if(CURRENTSTATE==ADDONSTATE.DEVELOPMENT){ ?>
    for (let [key, value] of Object.entries(propsobj).sort() ) {
      if(typeof value === 'object'){
        let $li = jQuery('<li>',{text: key});
        let $ol = jQuery('<ol>');
        for(let [keyB, valueB] of Object.entries(value).sort()){
          $ol.append('<li>'+keyB+' : '+valueB+'</li>')
        }
        jQuery($li).append($ol);
        jQuery('#userPropsFromServer').append($li);
      }
      else{
        jQuery('#userPropsFromServer').append('<li>'+key+' : '+value+'</li>');
      }
    }
    <? } ?>
    
    //spinner will disappear only when both jquery's dom manipulations are complete
    //and userprops are loaded from the server
    if(domopscomplete){ 
      $('.spinner').fadeOut("fast"); 
      // $('#tab1').append('<p>spinner was faded after properties populated</p>');
      // ^^^ THIS IS ALWAYS THE CASE, PROPERTIES UPDATE TAKES LONGER THAN JQUERY DOM MANIPULATION ^^^ //
    }
}

window.saveUserProps = function(userprops){
  $('.spinner').fadeIn("fast");
  delete userProps.populated;
  google.script.run.withSuccessHandler(userPropsUpdateSuccess).setUserProperties(userprops);
}

window.makeUnique = function(str) {
  return String.prototype.concat(...new Set(str));
}

window.userPropsUpdateSuccess = function(updatedProps){
  //redefine userProps.populated which we deleted upon saving userProps,
  //to avoid it being saved to Apps Script UserProperties
  userProps.populated = true;
  <? if(CURRENTSTATE==ADDONSTATE.DEVELOPMENT){ ?>
  jQuery('#userPropsAfterUpdate').empty();
  //updatedProps will have stringified values
  for (let [key, value] of Object.entries(updatedProps).sort()) {
    if(typeof value === 'string'){
      value = JSON.parse(value);
    }
    if(typeof value === 'object'){
      let $li = jQuery('<li>',{text: key});
      let $ol = jQuery('<ol>');
      for(let [keyB, valueB] of Object.entries(value).sort()){
        $ol.append('<li>'+keyB+' : '+valueB+'</li>')
      }
      jQuery($li).append($ol);
      jQuery('#userPropsAfterUpdate').append($li);
    }
    else{
      jQuery('#userPropsAfterUpdate').append('<li>'+key+' : '+value+'</li>');
    }
  }
  //now let's compare userProps with updatedPropsUnstringified, they should be the same!
  jQuery('#userPropsClientJSAfterUpdate').empty();
  for (let [key, value] of Object.entries(userProps).sort()) {
    if(typeof value === 'object'){
      let $li = jQuery('<li>',{text: key});
      let $ol = jQuery('<ol>');
      for(let [keyB, valueB] of Object.entries(value).sort()){
        $ol.append('<li>'+keyB+' : '+valueB+'</li>')
      }
      jQuery($li).append($ol);
      jQuery('#userPropsClientJSAfterUpdate').append($li);
    }
    else{
      jQuery('#userPropsClientJSAfterUpdate').append('<li>'+key+' : '+value+'</li>');
    }
  }
  <? } ?>
  $('.spinner').fadeOut("fast");
}

//window.COLORSWITCH = 0;
//window.COLORARRAY = ["blue","green"];

//Start our page manipulation and event handling
jQuery(document).ready(function(){
    //we will try to get a pure JSON obj, so we don't need to parse every value
    google.script.run.withSuccessHandler(passUserPropertiesServer2Client).getUserProperties(true); 
    
    //render interface with jquery ui and set events for ui
    jQuery('#accordion').accordion({heightStyle: "content"});
    jQuery('#tabs').tabs({
      active: $('#activetab').val()
    });
    
    jQuery('#tab1 .buttonset').controlgroup();
    
    jQuery('#tab2 .buttonset').controlgroup({
      "direction": "vertical"
    });
    
    
    $('ul.nav li').click(function(){
      var divid = $(this).data("divid");
      
      $('div.active-tab').fadeOut('slow','swing',function(){
        $(this).addClass('inactive-tab');
        $('div#'+divid).addClass('active-tab').fadeIn('slow','swing');
      });
      $('ul.nav li').removeClass('active');
      $(this).addClass('active');
    });
    
    $('#paragraphalign input[type=radio]').on('change',function(){
      if(this.checked){
        $('.liveview-quote').css({"text-align":this.value});
        userProps.ParagraphStyles.ParagraphAlign = this.value;
        saveUserProps(userProps);
      }
    });
    
    let $pos = $('#lineheightBtn').offset();
    let $hgt = $('#lineheightBtn').height();      
    $('#Lineheight-quote').selectmenu({width:'auto',change:function(event,ui){
      $('.liveview-quote').css({"line-height":this.value+"em"});
      userProps.ParagraphStyles.Lineheight = this.value;
      saveUserProps(userProps);
      } }).selectmenu("widget").css({"display": "none"});
    $('#lineheightBtn').on('click',function(){
      let $pos = $('#lineheightBtn').offset();
      let $hgt = $('#lineheightBtn').outerHeight();      
      $('#Lineheight-quote').selectmenu('open').selectmenu('menuWidget').offset({top:($pos.top+$hgt),left:$pos.left});
    });
    
    $('.indentbtn').on('click',function(){
      let thisid = $(this).attr("id");
      switch(thisid){
        case 'leftIndentIncreaseBtn':
          if(userProps.ParagraphStyles.LeftIndent < 2.5){
            userProps.ParagraphStyles.LeftIndent += .25;
          }
          break;
        case 'leftIndentDecreaseBtn':
          if(userProps.ParagraphStyles.LeftIndent > 0){
            userProps.ParagraphStyles.LeftIndent -= .25;
          }
          break;
        case 'rightIndentIncreaseBtn':
          if(userProps.ParagraphStyles.RightIndent < 2.5){
            userProps.ParagraphStyles.RightIndent += .25;
          }
          break;
        case 'rightIndentDecreaseBtn':
          if(userProps.ParagraphStyles.RightIndent > 0){
            userProps.ParagraphStyles.RightIndent -= .25;
          }
          break;
      }
      leftindent = Math.round(userProps.ParagraphStyles.LeftIndent * 28.3464567);   //convert to point size useful for CSS margin-left property
      rightindent = Math.round(userProps.ParagraphStyles.RightIndent * 28.3464567); //convert to point size useful for CSS margin-right property
      $('.liveview-quote').css({"margin-left":leftindent+"pt","margin-right":rightindent+"pt"}); 
      $('.bookchapter').css({"margin-left":leftindent+"pt","margin-right":rightindent+"pt"});
      $('.bibleversion').css({"margin-left":leftindent+"pt","margin-right":rightindent+"pt"});
      saveUserProps(userProps);
    });
    //$('#no-version-formatting').checkbox();
    
    $('span#bookchapterstyle input').change(function(){
      if(this.checked){
        switch(this.value){
          case '<?!=BGET.TEXTSTYLE.BOLD?>':
            $('.bookchapter').css({"font-weight":"bold"}); 
            userProps.BookChapterStyles.BOLD = true;
            break;
          case '<?!=BGET.TEXTSTYLE.ITALIC?>':
            $('.bookchapter').css({"font-style":"italic"}); 
            userProps.BookChapterStyles.ITALIC = true; 
            break;
          case '<?!=BGET.TEXTSTYLE.UNDERLINE?>':
            $('.bookchapter').css({"text-decoration":"underline"+(userProps.BookChapterStyles.STRIKETHROUGH ? ' line-through' : '')}); 
            userProps.BookChapterStyles.UNDERLINE = true;
            break;
          case '<?!=BGET.TEXTSTYLE.STRIKETHROUGH?>':
            $('.bookchapter').css({"text-decoration":"line-through"+(userProps.BookChapterStyles.UNDERLINE ? ' underline' : '')}); 
            userProps.BookChapterStyles.STRIKETHROUGH = true;
            break;
        }
      }
      else{
        let thisstyle = $(this).attr('id').replace("bookchapter-","");
        switch(thisstyle){
          case '<?!=BGET.TEXTSTYLE.BOLD?>':
            $('.bookchapter').css({"font-weight":"normal"}); 
            userProps.BookChapterStyles.BOLD = false;
            break;
          case '<?!=BGET.TEXTSTYLE.ITALIC?>':
            $('.bookchapter').css({"font-style":"normal"}); 
            userProps.BookChapterStyles.ITALIC = false; 
            break;
          case '<?!=BGET.TEXTSTYLE.UNDERLINE?>':
            $('.bookchapter').css({"text-decoration":(usrProps.BookChapterStyles.STRIKETHROUGH) ? ' line-through' : 'none'}); 
            userProps.BookChapterStyles.UNDERLINE = false;
            break;
          case '<?!=BGET.TEXTSTYLE.STRIKETHROUGH?>':
            $('.bookchapter').css({"text-decoration":(usrProps.BookChapterStyles.UNDERLINE) ? ' underline' : 'none'}); 
            userProps.BookChapterStyles.STRIKETHROUGH = false;
            break;
        }
      }
      saveUserProps(userProps);
    });
    
    $('span#bookchapteralignment input').change(function(){
      if(this.checked){
        switch(this.value){
          case '<?!=BGET.VALIGN.NORMAL?>': 
            $('.bookchapter').css({"position":"relative","top":"0px"});
            break;
          case '<?!=BGET.VALIGN.SUPERSCRIPT?>':
            $('.bookchapter').css({"position":"relative","top":"-4px"});
            break;
          case '<?!=BGET.VALIGN.SUBSCRIPT?>':
            $('.bookchapter').css({"position":"relative","top":"4px"});
            break;
        }
        userProps.BookChapterStyles.VALIGN = this.value; 
        saveUserProps(userProps);      
      }
      
    });

    $('select#bookchapter-fontsize').change(function(){
      var fontsize = $(this).val() + "px";
      $('.bookchapter').css({"font-size":fontsize});
      userProps.BookChapterStyles.FONT_SIZE = $(this).val();
      saveUserProps(userProps);
    });
    
    $('span#versenumberstyle input').change(function(){
      if($(this).is(':checked')){
        var thisstyle = $(this).attr('id').replace("versenumber-","");
        if(thisstyle=="bold"){ $('span.versenumber').css({"font-weight":"bold"}); userProps.VerseNumberStyles.BOLD = true; saveUserProps(userProps); }
        if(thisstyle=="italic"){ $('span.versenumber').css({"font-style":"italic"}); userProps.VerseNumberStyles.ITALIC = true; saveUserProps(userProps); }
        if(thisstyle=="underline"){ $('span.versenumber').css({"text-decoration":"underline"}); userProps.VerseNumberStyles.UNDERLINE = true; saveUserProps(userProps); }
      }
      else{
        var thisstyle = $(this).attr('id').replace("versenumber-","");
        if(thisstyle=="bold"){ $('span.versenumber').css({"font-weight":"normal"}); userProps.VerseNumberStyles.BOLD = false; saveUserProps(userProps); }
        if(thisstyle=="italic"){ $('span.versenumber').css({"font-style":"normal"}); userProps.VerseNumberStyles.ITALIC = false; saveUserProps(userProps); }
        if(thisstyle=="underline"){ $('span.versenumber').css({"text-decoration":"none"}); userProps.VerseNumberStyles.UNDERLINE = false; saveUserProps(userProps); }
      }
    });
    
    $('span#versenumberalignment input').change(function(){
      if(this.checked){
        switch(this.value){
          case '<?!=BGET.VALIGN.NORMAL?>': 
            $('span.versenumber').css({"position":"relative","top":"0px"});
            break;
          case '<?!=BGET.VALIGN.SUPERSCRIPT?>':
            $('span.versenumber').css({"position":"relative","top":"-4px"});
            break;
          case '<?!=BGET.VALIGN.SUBSCRIPT?>':
            $('span.versenumber').css({"position":"relative","top":"4px"});
            break;
        }
        userProps.VerseNumberStyles.VALIGN = this.value; 
        saveUserProps(userProps);      
      }
    });

    $('select#versenumber-fontsize').change(function(){
      var fontsize = $(this).val() + "px";
      $('span.versenumber').css({"font-size":fontsize});
      userProps.VerseNumberStyles.FONT_SIZE = $(this).val();
      saveUserProps(userProps);
    });

    $('span#versetextstyle input').change(function(){
      if(this.checked){
        var thisstyle = $(this).attr('id').replace("versetext-","");
        if(thisstyle=="bold"){ $('span.versetext').css({"font-weight":"bold"}); userProps.VerseTextStyles.BOLD = true; saveUserProps(userProps); }
        if(thisstyle=="italic"){ $('span.versetext').css({"font-style":"italic"}); userProps.VerseTextStyles.ITALIC = true; saveUserProps(userProps); }
        if(thisstyle=="underline"){ $('span.versetext').css({"text-decoration":"underline"}); userProps.VerseTextStyles.UNDERLINE = true; saveUserProps(userProps); }
      }
      else{
        var thisstyle = $(this).attr('id').replace("versetext-","");
        if(thisstyle=="bold"){ $('span.versetext').css({"font-weight":"normal"}); userProps.VerseTextStyles.BOLD = false; saveUserProps(userProps); }
        if(thisstyle=="italic"){ $('span.versetext').css({"font-style":"normal"}); userProps.VerseTextStyles.ITALIC = false; saveUserProps(userProps); }
        if(thisstyle=="underline"){ $('span.versetext').css({"text-decoration":"none"}); userProps.VerseTextStyles.UNDERLINE = false; saveUserProps(userProps); }
      }
    });
    
    $('span#versetextalignment input').change(function(){
      if(this.checked){
        //var thisstyle = $(this).attr('id').replace("versetext-","");
        switch(this.value){
          case '<?!=BGET.VALIGN.NORMAL?>': 
            $('span.versetext').css({"position":"relative","top":"0px"});
            break;
          case '<?!=BGET.VALIGN.SUPERSCRIPT?>':
            $('span.versetext').css({"position":"relative","top":"-4px"});
            break;
          case '<?!=BGET.VALIGN.SUBSCRIPT?>':
            $('span.versetext').css({"position":"relative","top":"4px"});
            break;
        }
        userProps.VerseTextStyles.VALIGN = this.value; 
        saveUserProps(userProps);
      }
    });
    
    $('select#versetext-fontsize').change(function(){
      var fontsize = $(this).val() + "px";
      $('span.versetext').css({"font-size":fontsize});
      userProps.VerseTextStyles.FONT_SIZE = $(this).val();
      saveUserProps(userProps);
    });

    $('input[type="color"]').change(function(){
      //alert($(this).val());
      var thisval = this.value;
      var thisid = $(this).attr('id').split('-');
      //alert("thisval = "+thisval+", thisid[0] = "+thisid[0]+", thisid[1] = "+thisid[1]);
      if(thisid[1]=='color'){
        $('.'+thisid[0]).css({"color":thisval});
        //google.script.run.consoleLog("thisid = "+thisid[0]+",thisval = "+thisval);
        if(thisid[0] == "bookchapter"){ userProps.BookChapterStyles.FOREGROUND_COLOR = thisval; saveUserProps(userProps); }
        if(thisid[0] == "versenumber"){ userProps.VerseNumberStyles.FOREGROUND_COLOR = thisval; saveUserProps(userProps); }
        if(thisid[0] == "versetext"){ userProps.VerseTextStyles.FOREGROUND_COLOR = thisval; saveUserProps(userProps); }
      }
      if(thisid[1]=='bgcolor'){
        $('.'+thisid[0]).css({"background-color":thisval});
        if(thisid[0] == "bookchapter"){ userProps.BookChapterStyles.BACKGROUND_COLOR = thisval; saveUserProps(userProps); }
        if(thisid[0] == "versenumber"){ userProps.VerseNumberStyles.BACKGROUND_COLOR = thisval; saveUserProps(userProps); }
        if(thisid[0] == "versetext"){ userProps.VerseTextStyles.BACKGROUND_COLOR = thisval; saveUserProps(userProps); }
      }
      
    });
    
    
    $('#no-version-formatting').change(function(){
      //google.script.run.consoleLog("checkbox was checked, current value is: "+$(this).prop("checked"));
      userProps.ParagraphStyles.NoVersionFormatting = $(this).prop("checked");
      saveUserProps(userProps);
    });
    
    $('#updatedata').click(function(){
      $('.spinner').show();
      google.script.run.refreshData();
    });

    jQuery('#tab3 .button').button();
    jQuery('#tab3 #RESET_DEFAULT_USERPROPS').on('click',function(){
      $('.spinner').show();
      google.script.run.resetUserProperties();
    });

    for(var i in ffAutoComplete){
      //let selcd = (ffAutoComplete[i] == userProps.FONT_FAMILY);
      $('#bibleget-font-family').append(jQuery('<option>',{value:ffAutoComplete[i],text:ffAutoComplete[i]})); //,selected:selcd
      if(i == ffAutoComplete.length-1){
        if(jQuery('#bibleget-font-family').find('option[value="<?!=userProperties.ParagraphStyles.FONT_FAMILY ?>"]').length > 0){
          jQuery('#bibleget-font-family').val('<?!=userProperties.ParagraphStyles.FONT_FAMILY ?>');
        }
        //jQuery('#bibleget-font-family').find('option[val="'+userProps.FONT_FAMILY+'"]').prop('selected',true);
        $('#bibleget-font-family').combobox()
        .combobox("widget").css({"font-family":"<?!=userProperties.ParagraphStyles.FONT_FAMILY ?>"});
        //$('#btnSetFont').button();
        jQuery('#bibleget-font-family').on('change',function(){
          //let myUI = jQuery(this).val();
          //jQuery('<span>',{text:myUI}).insertAfter('#tabs');
          userProps.ParagraphStyles.FONT_FAMILY = $(this).val();
          saveUserProps(userProps);
          $('#gfFontFamily').attr("href","https://fonts.googleapis.com/css?family="+userProps.ParagraphStyles.FONT_FAMILY+"&text="+makeUnique(userProps.ParagraphStyles.FONT_FAMILY+'<?!= UniqueStr ?>'));
          $('.bookchapter').add('p.liveview-quote').css({'font-family':userProps.ParagraphStyles.FONT_FAMILY});
          $('#bibleget-font-family').combobox("widget").css({"font-family":userProps.ParagraphStyles.FONT_FAMILY});
        });
        domopscomplete = true;
        if(userProps.populated){ $('.spinner').fadeOut("fast"); } //$('#tab1').append('<p>spinner was faded after domops completed</p>');
      }
    }
    
    $('#BookChapterFullQuery').button().on('change',function(){
      userProps.LayoutPrefs.BookChapterFullQuery = this.checked;
      if(this.checked){
            $('.bcText1Sam').text(bkChptr1Sam213 + ('<?!=locale?>'=='en' ? ':' : ',')+'1-3');
            $('.bcTextPs').text(bkChptrPs11412 + ('<?!=locale?>'=='en' ? ':' : ',')+'1-2');
      }
      else{
            $('.bcText1Sam').text(bkChptr1Sam213);
            $('.bcTextPs').text(bkChptrPs11412);
      }
      saveUserProps(userProps);
    }).parent('label').css({"margin-top":"6px"});
    
    $('#tab2').on('change','input[type=radio]', function(){
      if(this.checked){ 
        $('.spinner').fadeIn("fast");
        //alert(this.name + ' : ' + this.value);
        switch(this.name){
          case "ShowBibleVersion":
            switch(this.value){
              case '<?!=BGET.VISIBILITY.SHOW?>':
                jQuery('.fieldset-results').each(function(){
                  if(userProps.LayoutPrefs.BibleVersionPosition=='<?!=BGET.POS.TOP?>'){
                    $(this).find('p.bibleversion.showtop').show();
                    $(this).find('p.bibleversion.showbottom').hide();
                  }
                  else if(userProps.LayoutPrefs.BibleVersionPosition=='<?!=BGET.POS.BOTTOM?>'){
                    $(this).find('p.bibleversion.showtop').hide();
                    $(this).find('p.bibleversion.showbottom').show();
                  }
                });
                break;
              case '<?!=BGET.VISIBILITY.HIDE?>':
                jQuery('.fieldset-results').each(function(){
                  $(this).find('p.bibleversion').hide();
                });
                break;
            }
            break;
          case "BibleVersionWrap":
            var wrap1='';
            var wrap2='';
            switch(this.value){
              case '<?!=BGET.WRAP.PARENTHESES?>':
              wrap1= '(';
              wrap2 = ')';
              break;
            case '<?!=BGET.WRAP.BRACKETS?>':
              wrap1 = '[';
              wrap2 = ']';
              break;
            }
            jQuery('p.bibleversion').each(function(){
              $(this).find('span.bcWrap').first().text(wrap1);
              $(this).find('span.bcWrap').last().text(wrap2);
            });
            break;
          case "BibleVersionAlignment":
            jQuery('p.bibleversion').css({'text-align':this.value});
            break;
          case "BibleVersionPosition":
            switch(this.value){
              case '<?!=BGET.POS.TOP?>':
                jQuery('.fieldset-results').each(function(){
                  $(this).find('p.bibleversion.showtop').show();
                  $(this).find('p.bibleversion.showbottom').hide();
                });
                break;
              case '<?!=BGET.POS.BOTTOM?>':
                jQuery('.fieldset-results').each(function(){
                  $(this).find('p.bibleversion.showbottom').show();
                  $(this).find('p.bibleversion.showtop').hide();
                });
                break;
            }
            break;
          case "BookChapterFormat":
            switch(this.value){
              case '<?!=BGET.FORMAT.BIBLELANG?>':
                bkChptr1Sam213 = "I Samuelis 2";
                bkChptrPs11412 = "Psalmorum 114";
                break;
              case '<?!=BGET.FORMAT.BIBLELANGABBREV?>':
                bkChptr1Sam213 = "ISam 2";
                bkChptrPs11412 = "Ps 114";
                break;
              case '<?!=BGET.FORMAT.USERLANG?>':
                bkChptr1Sam213 = '<?!=__('ISamuelis2',locale)?>';
                bkChptrPs11412 = '<?!=__('Psalmorum114',locale)?>';
                break;
              case '<?!=BGET.FORMAT.USERLANGABBREV?>':
                bkChptr1Sam213 = '<?!=__('ISam2',locale)?>';
                bkChptrPs11412 = '<?!=__('Ps114',locale)?>';
                break;
            }
            if(JSON.parse(userProps.LayoutPrefs.BookChapterFullQuery)){
              $('.bcText1Sam').text(bkChptr1Sam213 + ('<?!=locale?>'=='en' ? ':' : ',')+'1-3');
              $('.bcTextPs').text(bkChptrPs11412 + ('<?!=locale?>'=='en' ? ':' : ',')+'1-2');
            }
            else{
              $('.bcText1Sam').text(bkChptr1Sam213);
              $('.bcTextPs').text(bkChptrPs11412);
            }
            break;
          case "BookChapterWrap":
            var wrap1='';
            var wrap2='';
            switch(this.value){
              case '<?!=BGET.WRAP.PARENTHESES?>':
              wrap1= '(';
              wrap2 = ')';
              break;
            case '<?!=BGET.WRAP.BRACKETS?>':
              wrap1 = '[';
              wrap2 = ']';
              break;
            }
            jQuery('.bookchapter').each(function(){
              $(this).find('span.bcWrap').first().text(wrap1);
              $(this).find('span.bcWrap').last().text(wrap2);
            });
            break;
          case "BookChapterAlignment":
            jQuery('.bookchapter').css({'text-align':this.value});
            break;
          case "BookChapterPosition":
            switch(this.value){
              case '<?!=BGET.POS.TOP?>':
                jQuery('div.bookchapterWrapper').each(function(){
                  $(this).find('.bookchapter').css({'display':'block','margin-left':(leftindent+'pt')}).prependTo(this);
                });
                break;
              case '<?!=BGET.POS.BOTTOM?>':
                jQuery('div.bookchapterWrapper').each(function(){
                  $(this).find('.bookchapter').css({'display':'block','margin-left':(rightindent+'pt')}).appendTo(this);
                });
                break;
              case '<?!=BGET.POS.BOTTOMINLINE?>':
                jQuery('div.bookchapterWrapper').each(function(){
                  $(this).find('.bookchapter').css({'display':'inline','margin-left':'6px'}).appendTo($(this).find('p.liveview-quote'));
                });
                break;
            }
            break;
          case "ShowVerseNumbers":
            switch(this.value){
              case '<?!=BGET.VISIBILITY.SHOW?>':
                jQuery('span.versenumber').show();
                break;
              case '<?!=BGET.VISIBILITY.HIDE?>':
                jQuery('span.versenumber').hide();
                break;
            }
            break;          
        }
        userProps.LayoutPrefs[this.name] = this.value;        
        saveUserProps(userProps);
      }
    });
        
});

</script>
</body>
<?
  if(CURRENTSTATE == ADDONSTATE.DEVELOPMENT){
    consoleLog('document body complete in Settings.html');
  }   
?>
